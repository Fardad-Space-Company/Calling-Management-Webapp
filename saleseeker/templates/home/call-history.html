{% extends "layouts/base.html" %}

{% block title %}Call History for sale team{% endblock %}

{% block stylesheets %}
<style>
    .pagination {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
    }
    .page-info {
        margin: 0 20px;
    }
    .filter-form {
        margin-bottom: 20px;
    }
    th.sortable {
        cursor: pointer;
    }
</style>
{% endblock stylesheets %}

{% block content %}
<div class="container">
    <h2>Call History for Sale Team</h2>
    <form method="get" class="filter-form">
        <div class="form-group">
            <label for="shop_name">Filter by Shop Name:</label>
            <input type="text" name="shop_name" id="shop_name" class="form-control" value="{{ shop_name }}">
        </div>
        <button type="submit" class="btn btn-primary">Filter</button>
    </form>
    <table class="table" id="callHistoryTable">
        <thead>
            <tr>
                <th class="sortable">
                    <a href="?page={{ current_page }}&shop_name={{ shop_name }}&sort_by=EmployeeID&sort_order={% if sort_by == 'EmployeeID' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Employee ID</a>
                </th>
                <th class="sortable">
                    <a href="?page={{ current_page }}&shop_name={{ shop_name }}&sort_by=ShopName&sort_order={% if sort_by == 'ShopName' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Shop Name</a>
                </th>
                <th class="sortable">
                    <a href="?page={{ current_page }}&shop_name={{ shop_name }}&sort_by=Date&sort_order={% if sort_by == 'Date' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Date</a>
                </th>
                <th class="sortable">
                    <a href="?page={{ current_page }}&shop_name={{ shop_name }}&sort_by=DealStatus&sort_order={% if sort_by == 'DealStatus' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Deal Status</a>
                </th>
                <th class="sortable">
                    <a href="?page={{ current_page }}&shop_name={{ shop_name }}&sort_by=Shop_Status&sort_order={% if sort_by == 'Shop_Status' and sort_order == 'asc' %}desc{% else %}asc{% endif %}">Shop Status</a>
                </th>
            </tr>
        </thead>
        <tbody>
            {% for entry in crm_data %}
            <tr>
                <td>{{ entry.EmployeeID }}</td>
                <td>{{ entry.ShopName }}</td>
                <td>{{ entry.Date }}</td>
                <td>{{ entry.DealStatus }}</td>
                <td>{{ entry.Shop_Status }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">No call history entries found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="pagination">
        {% if crm_data.has_previous %}
        <a class="btn btn-primary" href="?page={{ crm_data.previous_page_number }}&shop_name={{ shop_name }}&sort_by={{ sort_by }}&sort_order={{ sort_order }}">Previous</a>
        {% else %}
        <button class="btn btn-primary" disabled>Previous</button>
        {% endif %}
        <span class="page-info">Page {{ crm_data.number }} of {{ total_pages }}</span>
        {% if crm_data.has_next %}
        <a class="btn btn-primary" href="?page={{ crm_data.next_page_number }}&shop_name={{ shop_name }}&sort_by={{ sort_by }}&sort_order={{ sort_order }}">Next</a>
        {% else %}
        <button class="btn btn-primary" disabled>Next</button>
        {% endif %}
    </div>
</div>
{% endblock content %}
